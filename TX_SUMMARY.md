# üìù –†–µ–∑—é–º–µ: –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Ç—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

### üéØ 3 —É—Ä–æ–≤–Ω—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

1. **EtherScan API** (Source of truth)
   - –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –±–ª–æ–∫—á–µ–π–Ω–∞
   - –ü–æ–ª—É—á–∞–µ–º —á–µ—Ä–µ–∑ `getTokenTransfers()`
   - –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ

2. **Server Cache** (5 –º–∏–Ω—É—Ç)
   - ServerAction `getTransactionHistory()`
   - –£–º–µ–Ω—å—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ EtherScan
   - TTL: 300 —Å–µ–∫—É–Ω–¥ per publicKey
   - –ë—ã—Å—Ç—Ä–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

3. **localStorage** (Persistent)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
   - –î–æ 100 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (offline)
   - TTL: 5 –º–∏–Ω—É—Ç –¥–ª—è refresh

### üìÇ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

| –§–∞–π–ª                                | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                      |
| ----------------------------------- | ------------------------------- |
| `actions/transactions.actions.ts`   | Server Action –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è TX  |
| `lib/localStorage.ts`               | –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º |
| `components/TransactionHistory.tsx` | UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π         |
| `TRANSACTION_HISTORY.md`            | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è             |

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

**Server Side:**

```typescript
// –ü–æ–ª—É—á–∏—Ç—å TX —Å EtherScan –∏ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å
getTransactionHistory(publicKey, tokenAddress);
```

**Client Side (localStorage):**

```typescript
// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–¥–Ω—É TX
saveTransaction(tx);

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ TX
getStoredTransactions();

// –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
updateTransactionStatus(hash, status);

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
getTransactionStats();

// –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
clearTransactionHistory();
```

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

- ‚úÖ –í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –í—Ö–æ–¥—è—â–∏–µ (Incoming)
- ‚úÖ –ò—Å—Ö–æ–¥—è—â–∏–µ (Outgoing)
- ‚úÖ –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–π (completed, pending, failed)
- ‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ EtherScan –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

### üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:

```typescript
interface LocalTransaction {
  id: string; // TX hash
  hash: string; // Full TX hash
  from: string; // From address
  to: string; // To address
  value: string; // Amount
  timestamp: number; // Unix timestamp
  type: "in" | "out" | "pending";
  status: "completed" | "pending" | "failed";
  description?: string; // Custom text
}
```

### üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:**

1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ TX –∏–∑ localStorage (fast ‚ö°)
2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å (5 min passed?)
3. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Üí –∑–∞–ø—Ä–æ—Å–∏–º —Å —Å–µ—Ä–≤–µ—Ä–∞
4. –ü–æ–ª—É—á–∏–º —Å EtherScan —á–µ—Ä–µ–∑ ServerAction
5. –°–æ—Ö—Ä–∞–Ω–∏–º –≤ localStorage
6. –û–±–Ω–æ–≤–∏–º UI

**–ü—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**

1. Deposit/Withdraw –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω
2. –ü–æ–ª—É—á–∞–µ–º TX hash
3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ "pending"
4. –ù–∞ —Å–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Üí —Å—Ç–∞—Ç—É—Å "completed"

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

- **Server Cache TTL:** 300_000 –º—Å (5 –º–∏–Ω—É—Ç)
- **localStorage TTL:** 5 –º–∏–Ω—É—Ç
- **Max TX –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:** 100
- **–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ UI:** 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- Dev —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞

---

**–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞! üéâ**
